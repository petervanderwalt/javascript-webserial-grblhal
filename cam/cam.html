<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAM Pre-Processor</title>

    <!-- Fonts, Icons, Tailwind CSS (Unchanged) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Roboto:wght@400;500;700&family=JetBrains+Mono:wght@500;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
          theme: {
              extend: {
                  colors: {
                      primary: { DEFAULT: '#FFD949', dark: '#D7B232', light: '#FFF2AE' },
                      secondary: { DEFAULT: '#6A6B6A', dark: '#383838', light: '#D9D9D8' },
                      grey: { dark: '#2F373C', DEFAULT: '#909090', light: '#E2E8F0', background: '#F8F9FA' },
                      surface: '#FFFFFF'
                  },
                  fontFamily: {
                      heading: ['Nunito', 'sans-serif'],
                      body: ['Roboto', 'sans-serif'],
                      mono: ['JetBrains Mono', 'monospace']
                  },
                  boxShadow: {
                      'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.1)',
                      'card': '0 2px 4px rgba(0,0,0,0.05)'
                  }
              }
          }
      };
    </script>
    <style type="text/tailwindcss">
        @layer components {
            .app-container { @apply flex h-screen w-screen overflow-hidden bg-grey-background text-grey-dark font-body; }
            .sidebar { @apply w-[380px] flex-shrink-0 bg-white border-r border-grey-light flex flex-col z-30 shadow-soft; }
            .btn { @apply px-4 py-2 rounded-lg font-bold text-sm transition-all duration-200 flex items-center justify-center gap-2 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed; }
            .btn-primary { @apply bg-primary text-black hover:bg-primary-dark shadow-sm; }
            .btn-secondary { @apply bg-grey-background border border-grey-light text-grey-dark hover:border-secondary hover:text-secondary; }
            .info-panel { @apply bg-white p-4 rounded-xl border border-grey-light shadow-card; }
            .panel-header { @apply text-xs font-black text-grey uppercase tracking-wider mb-2 border-b border-grey-light pb-2;}
            .input-label { @apply text-xs font-bold text-grey-dark block mb-1; }
            .input-field { @apply w-full rounded-md border border-grey-light bg-grey-background/50 px-3 py-1.5 text-sm font-bold text-grey-dark focus:border-secondary focus:bg-white outline-none transition-colors; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar and Main Content Structure (unchanged) -->
        <aside class="sidebar">
            <div class="h-11 flex items-center px-4 bg-secondary-dark text-white shadow-md z-20"><span class="font-heading font-bold">CAM Pre-Processor</span></div>
            <div class="flex-1 overflow-y-auto p-3 flex flex-col gap-3">
                <div class="info-panel">
                    <h3 class="panel-header">File Operations</h3>
                    <label class="btn btn-primary w-full cursor-pointer"><i class="bi bi-folder2-open"></i> Open SVG / DXF<input type="file" id="file-input" class="hidden" accept=".dxf,.svg"></label>
                    <div id="status-panel" class="text-sm text-grey-dark space-y-1 mt-2">No file loaded.</div>
                </div>
                <div class="info-panel flex-1 flex flex-col">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="panel-header">Toolpaths</h3>
                        <button id="add-toolpath-btn" class="btn btn-secondary !text-xs !py-1 !px-2"><i class="bi bi-plus-circle"></i> Add Toolpath</button>
                    </div>
                    <div id="toolpath-list" class="space-y-1 mb-3 overflow-y-auto"></div>
                    <div id="toolpath-editor" class="hidden space-y-2 border-t border-grey-light pt-3"></div>
                </div>
                <div class="info-panel">
                    <h3 class="panel-header">Output</h3>
                    <div class="flex gap-2">
                         <button id="generate-preview-btn" class="btn btn-secondary w-full" disabled><i class="bi bi-eye"></i> Generate Preview</button>
                        <button id="generate-gcode-btn" class="btn btn-primary w-full" disabled><i class="bi bi-gear-fill"></i> Generate G-Code</button>
                    </div>
                    <textarea id="gcode-output" class="hidden w-full h-40 mt-3 font-mono text-xs border border-grey-light rounded-md p-2 bg-grey-background" readonly></textarea>
                </div>
            </div>
        </aside>
        <main class="flex-1 flex flex-col bg-grey-background relative overflow-hidden">
            <div id="viewer-container" class="w-full h-full"></div>
            <div id="loading-overlay" class="hidden absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
                <div class="bg-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3">
                    <div class="w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>
                    <span id="loading-text" class="font-bold text-grey-dark">Parsing File...</span>
                </div>
            </div>
        </main>
    </div>

    <!-- Shim for your legacy parser -->
    <script>var debug = false;</script>

    <!-- *** THE FIX IS HERE: Loading all scripts as classic, global scripts in the correct order *** -->

    <!-- Core Libraries -->
    <script src="https://unpkg.com/three@0.127.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.127.0/examples/js/controls/OrbitControls.js"></script>
    <script src="clipper.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dxf-parser@1.1.2/dist/dxf-parser.js"></script>

    <!-- Your Proven Parser -->
    <script src="lw.svg-parser.js"></script>
    <script src="svgparser.js"></script>

    <!-- Application Modules -->
    <script src="renderer.js"></script>
    <script src="ui.js"></script>
    <script src="file-parser.js"></script>
    <script src="gcode-generator.js"></script>
    <script src="toolpath-manager.js"></script>

    <!-- Main Entry Point -->
    <script src="main.js"></script>

</body>
</html>
